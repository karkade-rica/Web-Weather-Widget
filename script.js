const apiKey='c421857110df2b1e6445d5eafd267825';const cityInput=document.getElementById('city-input');const searchBtn=document.getElementById('search-btn');const weatherInfo=document.getElementById('weather-info');const loading=document.getElementById('loading');const error=document.getElementById('error');const cityName=document.getElementById('city-name');const temperature=document.getElementById('temperature');const weatherDescription=document.getElementById('weather-description');const weatherIcon=document.getElementById('weather-icon');const feelsLike=document.getElementById('feels-like');const humidity=document.getElementById('humidity');const windSpeed=document.getElementById('wind-speed');const defaultCities=document.querySelectorAll('.default-city');function showError(e){error.textContent=e,error.style.display='block',loading.style.display='none',weatherInfo.style.display='none'}function hideError(){error.style.display='none'}function showLoading(){loading.style.display='block',weatherInfo.style.display='none',hideError()}function showWeather(){loading.style.display='none',weatherInfo.style.display='block',hideError()}function getWeatherIcon(e){return e>=200&&e<300?'<i class="fas fa-bolt"></i>':e>=300&&e<500?'<i class="fas fa-cloud-rain"></i>':e>=500&&e<600?'<i class="fas fa-rain"></i>':e>=600&&e<700?'<i class="fas fa-snowflake"></i>':e>=700&&e<800?'<i class="fas fa-smog"></i>':800===e?'<i class="fas fa-sun"></i>':e>800?'<i class="fas fa-cloud"></i>':'<i class="fas fa-cloud-sun"></i>'}function getWeather(e){showLoading();const t=`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(e)}&units=metric&lang=ru&appid=${apiKey}`;fetch(t).then(e=>{if(!e.ok){if(404===e.status)throw new Error('Город не найден. Проверьте правильность написания.');if(401===e.status)throw new Error('Проблема с API ключом.');throw new Error('Ошибка соединения с сервером.')}return e.json()}).then(e=>{displayWeather(e)}).catch(e=>{showError('Ошибка: '+e.message)})}function displayWeather(e){cityName.textContent=e.name,temperature.textContent=Math.round(e.main.temp)+'°C',weatherDescription.textContent=e.weather[0].description,weatherIcon.innerHTML=getWeatherIcon(e.weather[0].id),feelsLike.textContent=Math.round(e.main.feels_like)+'°C',humidity.textContent=e.main.humidity+'%',windSpeed.textContent=e.wind.speed+' м/с',showWeather()}function saveLastCity(e){localStorage.setItem('lastWeatherCity',e)}function loadLastCity(){const e=localStorage.getItem('lastWeatherCity');return e||'Москва'}searchBtn.addEventListener('click',function(){const e=cityInput.value.trim();e&&(getWeather(e),saveLastCity(e),cityInput.value='')}),cityInput.addEventListener('keypress',function(e){'Enter'===e.key&&(e=cityInput.value.trim())&&(getWeather(e),saveLastCity(e),cityInput.value='')}),defaultCities.forEach(e=>{e.addEventListener('click',function(){const e=this.getAttribute('data-city');getWeather(e),saveLastCity(e)})}),window.addEventListener('DOMContentLoaded',function(){getWeather(loadLastCity())});
